generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum CoachRole {
  coach
  assistant_coach
}

enum PermissionLevel {
  read_only
  full_access
}

enum EventType {
  Tournament
  Practice
  Social_Event
  Strength_Conditioning
}

enum RepeatPattern {
  Weekly
  Every_Two_Weeks
}

enum InvitationStatus {
  pending
  accepted
  declined
}

enum ThreadType {
  one_to_one
  group
  team
}

enum MessageSenderType {
  coach
  player
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique @db.VarChar(50)
  password  String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@map("admin")
}

model Coaches {
  id                            Int             @id @default(autoincrement())
  profile_picture               String?         @db.VarChar(255)
  first_name                    String          @db.VarChar(50)
  last_name                     String          @db.VarChar(50)
  email                         String          @unique @db.VarChar(50)
  phone                         String?         @db.VarChar(20)
  password                      String?         @db.Text
  role                          CoachRole       @default(coach)
  permission_level              PermissionLevel @default(read_only)
  email_verified                Boolean         @default(false)
  reset_password_otp            String?         @db.VarChar(6)
  reset_password_otp_expires_at DateTime?
  createdAt                     DateTime        @default(now())
  updatedAt                     DateTime        @updatedAt

  teams          TeamCoaches[]
  events         Events[]
  uniform_sizing CoachUniformSizing?

  sent_messages       Messages[]
  thread_participants ThreadParticipants[]
  message_reactions   MessageReactions[]

  @@index([email])
  @@map("coaches")
}

model Players {
  id                            Int       @id @default(autoincrement())
  team_id                       Int?
  profile_picture               String?   @db.VarChar(255)
  hero_image                    String?   @db.VarChar(255)
  first_name                    String    @db.VarChar(50)
  last_name                     String    @db.VarChar(50)
  email                         String    @unique @db.VarChar(50)
  password                      String    @db.Text
  phone                         String?   @db.VarChar(50)
  date_of_birth                 DateTime?
  age                           Int?
  high_school_class             String?   @db.VarChar(20)
  positions                     String[]
  jersey_number                 Int?
  bat_hand                      String?   @db.VarChar(20)
  throw_hand                    String?   @db.VarChar(20)
  height                        String?   @db.VarChar(20)
  weight                        String?   @db.VarChar(20)
  high_school                   String?   @db.VarChar(20)
  sat_score                     Int?
  act_score                     Int?
  gpa                           Float?
  commited_school               String?   @db.VarChar(20)
  instagram_handle              String?   @db.VarChar(20)
  facebook_handle               String?   @db.VarChar(20)
  x_handle                      String?   @db.VarChar(20)
  email_verified                Boolean   @default(false)
  email_verification_otp        String?   @db.VarChar(6)
  email_verification_expires_at DateTime?
  reset_password_otp            String?   @db.VarChar(6)
  reset_password_expires_at     DateTime?
  last_login_at                 DateTime?
  createdAt                     DateTime  @default(now())
  updatedAt                     DateTime  @updatedAt

  team           Teams?               @relation(fields: [team_id], references: [id], onDelete: SetNull)
  guardians      Json?                @default("[]")
  parents        PlayerParents[]
  uniform_sizing PlayerUniformSizing?

  sent_messages       Messages[]
  thread_participants ThreadParticipants[]
  message_reactions   MessageReactions[]

  @@index([email])
  @@index([team_id])
  @@map("players")
}

model Teams {
  id                Int      @id @default(autoincrement())
  name              String   @db.VarChar(100)
  age_group         String   @db.VarChar(20)
  unique_code       String   @unique @db.VarChar(6)
  team_pictures_url String?  @db.VarChar(255)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  coaches TeamCoaches[]
  players Players[]
  tryouts Tryouts[]
  events  Events[]
  threads Threads[]

  @@map("teams")
}

model TeamCoaches {
  team_id  Int
  coach_id Int

  team  Teams   @relation(fields: [team_id], references: [id], onDelete: Cascade)
  coach Coaches @relation(fields: [coach_id], references: [id], onDelete: Cascade)

  @@id([team_id, coach_id])
  @@map("team_coaches")
}

model Tryouts {
  id                    Int      @id @default(autoincrement())
  team_id               Int
  name                  String   @db.VarChar(100)
  age_group             String   @db.VarChar(50)
  date                  DateTime
  time                  String   @db.VarChar(20)
  address               String   @db.Text
  registration_deadline DateTime
  notes                 String?  @db.Text
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  team Teams @relation(fields: [team_id], references: [id], onDelete: Cascade)

  @@index([team_id])
  @@map("tryouts")
}

model Events {
  id                   Int            @id @default(autoincrement())
  team_id              Int
  event_type           EventType
  name                 String         @db.VarChar(100)
  start_date           DateTime
  end_date             DateTime?
  start_time           String         @db.VarChar(20)
  end_time             String         @db.VarChar(20)
  location             String?        @db.VarChar(255)
  address              String         @db.Text
  event_link           String?        @db.Text
  gamechanger_link     String?        @db.Text
  notes                String?        @db.Text
  is_recurring         Boolean        @default(false)
  repeat_pattern       RepeatPattern?
  repeat_days          String[]
  end_recurrence_count Int?
  end_recurrence_date  DateTime?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt

  team    Teams     @relation(fields: [team_id], references: [id], onDelete: Cascade)
  coaches Coaches[]

  @@map("events")
}

model PlayerUniformSizing {
  id             Int      @id @default(autoincrement())
  player_id      Int      @unique
  jersey_size    String?  @db.VarChar(20)
  hat_size       String?  @db.VarChar(20)
  helmet_size    String?  @db.VarChar(20)
  helmet_side    String?  @db.VarChar(20)
  jersey_pants   String?  @db.VarChar(20)
  pant_style     String?  @db.VarChar(50)
  shirt_size     String?  @db.VarChar(20)
  short_size     String?  @db.VarChar(20)
  youth_belt     String?  @db.VarChar(20)
  adult_belt     String?  @db.VarChar(20)
  sock_size      String?  @db.VarChar(20)
  shoe_size      String?  @db.VarChar(20)
  sweater_jacket String?  @db.VarChar(20)
  is_catcher     Boolean  @default(false)
  batting_glove  String?  @db.VarChar(20)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  player Players @relation(fields: [player_id], references: [id], onDelete: Cascade)

  @@index([player_id])
  @@map("player_uniform_sizing")
}

model CoachUniformSizing {
  id           Int      @id @default(autoincrement())
  coach_id     Int      @unique
  hat_size     String?  @db.VarChar(20)
  shirt_size   String?  @db.VarChar(20)
  short_size   String?  @db.VarChar(20)
  long_sleeves String?  @db.VarChar(20)
  hoodie_size  String?  @db.VarChar(20)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  coach Coaches @relation(fields: [coach_id], references: [id], onDelete: Cascade)

  @@index([coach_id])
  @@map("coach_uniform_sizing")
}

model Parents {
  id                            Int       @id @default(autoincrement())
  first_name                    String    @db.VarChar(50)
  last_name                     String    @db.VarChar(50)
  email                         String    @unique @db.VarChar(50)
  password                      String    @db.Text
  email_verified                Boolean   @default(false)
  email_verification_otp        String?   @db.VarChar(6)
  email_verification_expires_at DateTime?
  reset_password_otp            String?   @db.VarChar(6)
  reset_password_expires_at     DateTime?
  createdAt                     DateTime  @default(now())
  updatedAt                     DateTime  @updatedAt

  players PlayerParents[]

  @@index([email])
  @@map("parents")
}

model PlayerParents {
  player_id             Int
  parent_id             Int
  relationship          String?          @db.VarChar(50)
  invitation_token      String?          @db.VarChar(255)
  invitation_expires_at DateTime?
  invitation_status     InvitationStatus @default(pending)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt

  player Players @relation(fields: [player_id], references: [id], onDelete: Cascade)
  parent Parents @relation(fields: [parent_id], references: [id], onDelete: Cascade)

  @@id([player_id, parent_id])
  @@map("player_parents")
}

model Threads {
  id        Int        @id @default(autoincrement())
  name      String?    @db.VarChar(100)
  type      ThreadType @default(one_to_one)
  team_id   Int?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  team         Teams?               @relation(fields: [team_id], references: [id], onDelete: Cascade)
  messages     Messages[]
  participants ThreadParticipants[]

  @@map("threads")
}

model ThreadParticipants {
  id        Int  @id @default(autoincrement())
  thread_id Int
  coach_id  Int?
  player_id Int?

  thread Threads  @relation(fields: [thread_id], references: [id], onDelete: Cascade)
  coach  Coaches? @relation(fields: [coach_id], references: [id], onDelete: Cascade)
  player Players? @relation(fields: [player_id], references: [id], onDelete: Cascade)

  @@map("thread_participants")
}

model Messages {
  id          Int               @id @default(autoincrement())
  thread_id   Int
  sender_type MessageSenderType
  coach_id    Int?
  player_id   Int?
  content     String            @db.Text
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  thread    Threads            @relation(fields: [thread_id], references: [id], onDelete: Cascade)
  coach     Coaches?           @relation(fields: [coach_id], references: [id], onDelete: SetNull)
  player    Players?           @relation(fields: [player_id], references: [id], onDelete: SetNull)
  reactions MessageReactions[]

  @@map("messages")
}

model MessageReactions {
  id          Int               @id @default(autoincrement())
  message_id  Int
  emoji       String            @db.VarChar(10)
  sender_type MessageSenderType
  coach_id    Int?
  player_id   Int?
  createdAt   DateTime          @default(now())

  message Messages @relation(fields: [message_id], references: [id], onDelete: Cascade)
  coach   Coaches? @relation(fields: [coach_id], references: [id], onDelete: Cascade)
  player  Players? @relation(fields: [player_id], references: [id], onDelete: Cascade)

  @@map("message_reactions")
}
